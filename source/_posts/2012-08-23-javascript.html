---
layout: post
title: "Javascript 淺析註冊事件"
date: 2012-08-23T15:10:00+08:00
categories:
 - JavsScript
---

<div class='post'>
<style type="text/css"><!-- pre { font-family: monospace; color: #ffffff; background-color: #333333; } body { font-family: monospace; color: #ffffff; background-color: #333333; } .Special { color: #ffdead; } .Constant { color: #ffa0a0; } .Type { color: #bdb76b; font-weight: bold; } .Statement { color: #f0e68c; font-weight: bold; } .Identifier { color: #98fb98; }  code {      display: block; /* fixes a strange ie margin bug */     font-family: Courier New;      font-size: 8pt;      overflow:auto;      background: #f0f0f0 url(https://sites.google.com/site/yehchge/home/Code_BG.png) left top repeat-y;     border: 1px solid #ccc;     padding: 1px 1px 1px 12px;     max-height:400px;     line-height: 1.2em; } --></style> 原文：http://www.wowbox.com.tw/blog/article.asp?id=3004 <br />首先是最常規的方法：<br />程式碼: <pre><code><pre><br /><span class="Identifier">&lt;</span><span class="Statement">p</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">"para"</span><span class="Identifier"> </span><span class="Type">title</span><span class="Identifier">=</span><span class="Constant">"cssrain demo!"</span><span class="Identifier"> </span><span class="Special">onclick="</span><span class="Special">test</span>()<span class="Special">"</span><span class="Identifier"> &gt;</span>test<span class="Identifier">&lt;/</span><span class="Statement">p</span><span class="Identifier">&gt;</span><br /><span class="Identifier">&lt;</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /><span class="Identifier">function</span><span class="Special"> test</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">"test"</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /></pre></code></pre><br/>當某一天，我們知道JavaScript要跟HTML結構實現分離後，就會改了一種寫法：<br/></br>程式碼: <pre><code><pre><br /><span class="Identifier">&lt;</span><span class="Statement">p</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;para&quot;</span><span class="Identifier"> </span><span class="Type">title</span><span class="Identifier">=</span><span class="Constant">&quot;cssrain demo!&quot;</span><span class="Identifier">&gt;</span>test<span class="Identifier">&lt;/</span><span class="Statement">p</span><span class="Identifier">&gt;</span><br /><span class="Identifier">&lt;</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /><span class="Identifier">function</span><span class="Special"> test</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;test&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><span class="Statement">window</span><span class="Special">.onload = </span><span class="Identifier">function</span>()<span class="Identifier">{</span><br /><span class="Special">    </span><span class="Statement">document</span><span class="Special">.getElementById</span>(<span class="Constant">&quot;para&quot;</span>)<span class="Special">.onclick = test;</span><br /><span class="Identifier">}</span><br /><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /></pre></code></pre><br/>當我們工作越來越久後，有時候我們需要對某個元素綁定多個相同的事件類型：<br/><br/>程式碼: <pre><code><pre><br /><span class="Identifier">&lt;</span><span class="Statement">p</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;para&quot;</span><span class="Identifier"> </span><span class="Type">title</span><span class="Identifier">=</span><span class="Constant">&quot;cssrain demo!&quot;</span><span class="Identifier">&gt;</span>test<span class="Identifier">&lt;/</span><span class="Statement">p</span><span class="Identifier">&gt;</span><br /><span class="Identifier">&lt;</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /><span class="Identifier">function</span><span class="Special"> test</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;test&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Identifier">function</span><span class="Special"> pig</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;pig&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Statement">window</span><span class="Special">.onload = </span><span class="Identifier">function</span>()<span class="Identifier">{</span><br /><span class="Special">     </span><span class="Statement">document</span><span class="Special">.getElementById</span>(<span class="Constant">&quot;para&quot;</span>)<span class="Special">.onclick = test;</span><br /><span class="Special">     </span><span class="Statement">document</span><span class="Special">.getElementById</span>(<span class="Constant">&quot;para&quot;</span>)<span class="Special">.onclick = pig;</span><br /><span class="Identifier">}</span><br /><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /></pre></code></pre><br/>如果按照上面的寫法，我們只能輸出第二個函數。<br/>這時候我們需要用到attachEvent方法：<br/><br/>程式碼: <pre><code><pre><br /><span class="Identifier">&lt;</span><span class="Statement">p</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;para&quot;</span><span class="Identifier"> </span><span class="Type">title</span><span class="Identifier">=</span><span class="Constant">&quot;cssrain demo!&quot;</span><span class="Identifier">&gt;</span>test<span class="Identifier">&lt;/</span><span class="Statement">p</span><span class="Identifier">&gt;</span><br /><span class="Identifier">&lt;</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /><span class="Identifier">function</span><span class="Special"> test</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;test&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Identifier">function</span><span class="Special"> pig</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;pig&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Statement">window</span><span class="Special">.onload = </span><span class="Identifier">function</span>()<span class="Identifier">{</span><br /><span class="Special">     </span><span class="Statement">document</span><span class="Special">.getElementById</span>(<span class="Constant">&quot;para&quot;</span>)<span class="Special">.attachEvent</span>(<span class="Constant">&quot;onclick&quot;</span><span class="Special">,test</span>)<span class="Special">;</span><br /><span class="Special">     </span><span class="Statement">document</span><span class="Special">.getElementById</span>(<span class="Constant">&quot;para&quot;</span>)<span class="Special">.attachEvent</span>(<span class="Constant">&quot;onclick&quot;</span><span class="Special">,pig</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /></pre></code></pre><br/>在一段時間內，你並沒發現這段代碼有任何錯誤。<br/>某一天，一個名叫firefox的瀏覽器 闖入你的視野，當我們把這段代碼放到firefox中執行後，<br/>發現並不能正常運行。 問題就這樣，越來越多，然而作為一名JS程式設計師，這些都是必須面對的。<br/><br/>為了解決這段代碼的平台兼容性問題，我翻翻手冊，知道了firefox跟ie的區別：<br/>firefox中註冊事件使用：addEventListener方法，同時為了兼容ie，我們必須用到if ... else...<br/><br/>程式碼: <pre><code><pre><br /><span class="Identifier">&lt;</span><span class="Statement">p</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;para&quot;</span><span class="Identifier"> </span><span class="Type">title</span><span class="Identifier">=</span><span class="Constant">&quot;cssrain demo!&quot;</span><span class="Identifier">&gt;</span>test<span class="Identifier">&lt;/</span><span class="Statement">p</span><span class="Identifier">&gt;</span><br /><span class="Identifier">&lt;</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /><span class="Identifier">function</span><span class="Special"> test</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;test&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Identifier">function</span><span class="Special"> pig</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;pig&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Statement">window</span><span class="Special">.onload = </span><span class="Identifier">function</span>()<span class="Identifier">{</span><br /><span class="Special">         </span><span class="Identifier">var</span><span class="Special"> element =  </span><span class="Statement">document</span><span class="Special">.getElementById</span>(<span class="Constant">&quot;para&quot;</span>)<span class="Special">;</span><br /><span class="Special">         </span><span class="Statement">if</span>(<span class="Special">element.addEventListener</span>)<span class="Identifier">{</span><span class="Special">  </span><span class="Comment">// firefox  , w3c</span><br /><span class="Special">                element.addEventListener</span>(<span class="Constant">&quot;click&quot;</span><span class="Special">,test,</span><span class="Constant">false</span>)<span class="Special">;</span><br /><span class="Special">    element.addEventListener</span>(<span class="Constant">&quot;click&quot;</span><span class="Special">,pig,</span><span class="Constant">false</span>)<span class="Special">;</span><br /><span class="Special">         </span><span class="Identifier">}</span><span class="Special"> </span><span class="Statement">else</span><span class="Special"> </span><span class="Identifier">{</span><span class="Special">   </span><span class="Comment">// ie </span><br /><span class="Special">    element.attachEvent</span>(<span class="Constant">&quot;onclick&quot;</span><span class="Special">,test</span>)<span class="Special">;</span><br /><span class="Special">    element.attachEvent</span>(<span class="Constant">&quot;onclick&quot;</span><span class="Special">,pig</span>)<span class="Special">;</span><br /><span class="Special">         </span><span class="Identifier">}</span><br /><span class="Identifier">}</span><br /><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /></pre></code></pre><br/>此時，代碼就可以在多個平台上工作了。<br/><br/>但隨著水平的進步，你不滿足每次都去判斷，你想把這個判斷封裝起來，以後可以直接調用：<br/><br/>程式碼: <pre><code><pre><br /><span class="Identifier">&lt;</span><span class="Statement">p</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;para&quot;</span><span class="Identifier"> </span><span class="Type">title</span><span class="Identifier">=</span><span class="Constant">&quot;cssrain demo!&quot;</span><span class="Identifier">&gt;</span>test<span class="Identifier">&lt;/</span><span class="Statement">p</span><span class="Identifier">&gt;</span><br /><span class="Identifier">&lt;</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /><span class="Identifier">function</span><span class="Special"> test</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;test&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Identifier">function</span><span class="Special"> pig</span>()<span class="Identifier">{</span><br /><span class="Special">  </span><span class="Statement">alert</span>(<span class="Constant">&quot;pig&quot;</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><br /><span class="Identifier">function</span><span class="Special"> addListener</span>(<span class="Special">element,e,fn</span>)<span class="Identifier">{</span><br /><span class="Special">     </span><span class="Statement">if</span>(<span class="Special">element.addEventListener</span>)<span class="Identifier">{</span><br /><span class="Special">          element.addEventListener</span>(<span class="Special">e,fn,</span><span class="Constant">false</span>)<span class="Special">;</span><br /><span class="Special">     </span><span class="Identifier">}</span><span class="Special"> </span><span class="Statement">else</span><span class="Special"> </span><span class="Identifier">{</span><br /><span class="Special">          element.attachEvent</span>(<span class="Constant">&quot;on&quot;</span><span class="Special"> + e,fn</span>)<span class="Special">;</span><br /><span class="Special">     </span><span class="Identifier">}</span><br /><span class="Identifier">}</span><br /><br /><span class="Statement">window</span><span class="Special">.onload = </span><span class="Identifier">function</span>()<span class="Identifier">{</span><br /><span class="Special">         </span><span class="Identifier">var</span><span class="Special"> element =  </span><span class="Statement">document</span><span class="Special">.getElementById</span>(<span class="Constant">&quot;para&quot;</span>)<span class="Special">;</span><br /><span class="Special">         addListener</span>(<span class="Special">element,</span><span class="Constant">&quot;click&quot;</span><span class="Special">,test</span>)<span class="Special">;</span><br /><span class="Special">         addListener</span>(<span class="Special">element,</span><span class="Constant">&quot;click&quot;</span><span class="Special">,pig</span>)<span class="Special">;</span><br /><span class="Identifier">}</span><br /><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span><br /></pre></code></pre><br/>至此，作為一個程式設計師的工作就完了。<br/>中間我們從一個最傳統，最基本的寫法，然後實現Js和HTML的分離，然後又實現對同一個元素註冊多個事件，期間，<br/>我們發現註冊事件的兼容性問題。最後我們對註冊事件的方法進行封裝，方便以後使用。 <br/>  </div>
